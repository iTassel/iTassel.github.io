/*
 * Like getpass(3) but with timeout and echo flags.
 */
char *tgetpass(const char *prompt, int timeout, int flags,struct sudo_conv_callback *callback)
{
    struct sigaction sa, savealrm, saveint, savehup, savequit, saveterm;
    struct sigaction savetstp, savettin, savettou;
    char *pass;
    static const char *askpass;
    static char buf[SUDO_CONV_REPL_MAX + 1];
    int i, input, output, save_errno, neednl = 0, need_restart;
    debug_decl(tgetpass, SUDO_DEBUG_CONV)

    (void) fflush(stdout);

    if (askpass == NULL)
    {
		askpass = getenv_unhooked("SUDO_ASKPASS");
		if (askpass == NULL || *askpass == '\0')
			askpass = sudo_conf_askpass_path();  //get the askpass from the environment
    }

    /* If no tty present and we need to disable echo, try askpass. */
    if (!ISSET(flags, TGP_STDIN|TGP_ECHO|TGP_ASKPASS|TGP_NOECHO_TRY) &&!tty_present())
    {
		if (askpass == NULL || getenv_unhooked("DISPLAY") == NULL) {
			sudo_warnx(U_("no tty present and no askpass program specified"));
			debug_return_str(NULL);
		}
		SET(flags, TGP_ASKPASS);
    }

    /* If using a helper program to get the password, run it instead. */
    if (ISSET(flags, TGP_ASKPASS))
    {
		if (askpass == NULL || *askpass == '\0')
			sudo_fatalx(U_("no askpass program specified, try setting SUDO_ASKPASS"));
		debug_return_str_masked(sudo_askpass(askpass, prompt));
    }
    //.......
    pass = getln(input, buf, sizeof(buf), ISSET(flags, TGP_MASK));
    //......
}
