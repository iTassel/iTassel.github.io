extern int sudo_term_erase, sudo_term_kill;

static char *getln(int fd, char *buf, size_t bufsiz, int feedback)
{
    size_t left = bufsiz;
    ssize_t nr = -1;
    char *cp = buf;
    char c = '\0';
    debug_decl(getln, SUDO_DEBUG_CONV)

    if (left == 0) {
	errno = EINVAL;
	debug_return_str(NULL);		/* sanity */
    }

    while (--left) {
	nr = read(fd, &c, 1);
	if (nr != 1 || c == '\n' || c == '\r')
	    break;
	if (feedback) {
		if (c == sudo_term_kill) {
			while (cp > buf)
			{
				if (write(fd, "\b \b", 3) == -1)
				break;
				--cp;
			}
			left = bufsiz;
			continue;
	    }
	    else if (c == sudo_term_erase) {
			if (cp > buf)
			{
				if (write(fd, "\b \b", 3) == -1)
				break;
				--cp;
				left++;
			}
			continue;
	    }
	    ignore_result(write(fd, "*", 1));
	}
	*cp++ = c;
    }
    //......
}
